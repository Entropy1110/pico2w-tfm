# TFLM (TensorFlow Lite Micro) λ³΄μ• μ„λΉ„μ¤ κµ¬ν„ TODO λ¦¬μ¤νΈ

## ν”„λ΅μ νΈ κ°μ”
Raspberry Pi Pico 2Wμ—μ„ TF-M(Trusted Firmware-M)μ„ μ‚¬μ©ν•μ—¬ TFLM μ¶”λ΅ μ„ λ³΄μ• νν‹°μ…μ—μ„ μ‹¤ν–‰ν•λ” μ‹μ¤ν… κµ¬ν„

---

## 1. TFLM μ„λΉ„μ¤ μΈν„°νμ΄μ¤ μ •μ

**λ‹΄λ‹Ήμ:** λ‚¨μ μ°¬  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [x] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ νμΌ
- `tflm_interface/include/psa_tflm_defs.h`
- `tflm_interface/ns/psa_tflm_client.h`

### μ£Όμ” μ‘μ—…
- [x] **psa_tflm_defs.h λ‚΄μ© κ²€ν†  λ° μμ •**
  - PSA_TFLM_SERVICE_SID μ •μ ν™•μΈ
  - PSA_TFLM_SERVICE_SIGNAL μ •μ ν™•μΈ
  - μ”μ²­ νƒ€μ… μƒμ μ •μ (PSA_TFLM_REQUEST_TYPE_ECHO, LOAD_MODEL, RUN_INFERENCE λ“±)
  - κµ¬μ΅°μ²΄ μ •μ (tflm_model_info_t, tflm_inference_request_t, tflm_inference_response_t)

- [x] **psa_tflm_client.h ν΄λΌμ΄μ–ΈνΈ API κ²€ν† **
  - psa_tflm_echo, psa_tflm_load_model, psa_tflm_run_inference ν•¨μ μ„ μ–Έ ν™•μΈ
  - ν•„μ”ν• μ¶”κ°€ API μ •μ

**μ‚¬μ© API:** `psa/client.h`, `psa/error.h`

---

## 2. TFLM λ³΄μ• νν‹°μ… κΈ°λ³Έ κµ¬μ΅° μƒμ„±

**λ‹΄λ‹Ήμ:** λ‚¨μ μ°¬  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [x] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ λ””λ ‰ν† λ¦¬
- `tflm_spe/partitions/` (νν‹°μ… κµ¬ν„)
- `tflm_spe/` (λ§¤λ‹νμ¤νΈ)

### μ£Όμ” μ‘μ—…
- [x] **λ§¤λ‹νμ¤νΈ νμΌ κ²€ν†  λ° μμ •**
  - `tflm_spe/tflm_secure_service_sp.yaml`
  - `tflm_spe/tflm_manifest_list.yaml`

- [x] **CMakeLists.txt λΉλ“ μ„¤μ • κ²€ν† **
  - `tflm_spe/partitions/CMakeLists.txt`
  - include κ²½λ΅ ν™•μΈ (../../tflm_interface/include) - β… κ²½λ΅ μμ • μ™„λ£
  - μ†μ¤ νμΌ λ©λ΅ ν™•μΈ

- [x] **νν‹°μ… μ†μ¤ νμΌ κ²€ν†  λ° μμ •**
  - `tflm_spe/partitions/tflm_secure_service_sp.h`
  - `tflm_spe/partitions/tflm_secure_service_sp.c`
  - PSA λ©”μ‹μ§€ λ£¨ν”„ κµ¬ν„ ν™•μΈ
  - μ”μ²­ νƒ€μ…λ³„ λ¶„κΈ° μ²λ¦¬ ν™•μΈ

**μ‚¬μ© API:** `psa/service.h`, `tfm_log_unpriv.h`

---

## 3. λΉ„λ³΄μ• μ• ν”λ¦¬μΌ€μ΄μ… κΈ°λ³Έ ν΄λΌμ΄μ–ΈνΈ μ‘μ„±

**λ‹΄λ‹Ήμ:** λ‚¨μ μ°¬  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [x] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ λ””λ ‰ν† λ¦¬
- `tflm_ns/app/` (λ…λ¦½ μ‹¤ν–‰ν• NS μ•±)
- `app_broker/` (λΈλ΅μ»¤ ν†µν•©)

### μ£Όμ” μ‘μ—…
- [x] **NS μ• ν”λ¦¬μΌ€μ΄μ… main ν•¨μ κ²€ν† **
  - `tflm_ns/app/tflm_main.c`
  - ν΄λΌμ΄μ–ΈνΈ API νΈμ¶ λ΅μ§ ν™•μΈ
  - λ΅κ·Έ μ¶λ ¥ κΈ°λ¥ ν™•μΈ

- [x] **CMakeLists.txt μ„¤μ • κ²€ν† **
  - `tflm_ns/app/CMakeLists.txt`
  - `app_broker/CMakeLists.txt`
  - include κ²½λ΅ ν™•μΈ (../../tflm_interface/include, ../../tflm_interface/ns) - β… κ²½λ΅ μμ • μ™„λ£
  - μ†μ¤ νμΌ λ©λ΅ ν™•μΈ (tflm_main.c, psa_tflm_client.c) - β… λ§ν¬ μ¤λ¥ ν•΄κ²° μ™„λ£

- [x] **ν΄λΌμ΄μ–ΈνΈ κµ¬ν„ κ²€ν† **
  - `tflm_interface/ns/psa_tflm_client.c`
  - PSA API νΈμ¶ κµ¬ν„ ν™•μΈ

**μ‚¬μ© API:** `psa/client.h`, `tflm_interface/ns/psa_tflm_client.h`

---

## 4. λ¨λΈ μ•”νΈν™” μ¤ν¬λ¦½νΈ μ‘μ„± + ν”„λ΅λΉ„μ €λ‹

**λ‹΄λ‹Ήμ:** μ†΅ν„μ¤€  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ νμΌ
- `tools/model_provisioning/encrypt_model.py` (μ‹ κ· μƒμ„±)
- `tflm_spe/partitions/encrypted_model_data.h` (μ¤ν¬λ¦½νΈλ΅ μƒμ„±)

### μ£Όμ” μ‘μ—…
- [ ] **tools/model_provisioning/ λ””λ ‰ν† λ¦¬ μƒμ„±**

- [ ] **encrypt_model.py μ¤ν¬λ¦½νΈ μ‘μ„±**
  - TFLite λ¨λΈ νμΌ(.tflite) μ…λ ¥ μ²λ¦¬
  - AES-GCM μ•”νΈν™” κµ¬ν„
  - ν‚¤ κ΄€λ¦¬ (HUK κΈ°λ° λλ” κ°λ°μ© κ³ μ • ν‚¤)
  - C ν—¤λ” νμΌ μƒμ„± (nonce, μ•”νΈλ¬Έ, μ›λ³Έ κΈΈμ΄)

- [ ] **encrypted_model_data.h μλ™ μƒμ„± ν™•μΈ**
  - C λ°°μ—΄ λ³€μ μ„ μ–Έ ν•μ‹
  - tflm_spe/partitions/ λ””λ ‰ν† λ¦¬μ— μ €μ¥

- [ ] **ν…μ¤νΈμ© μƒν” TFLite λ¨λΈ μ¤€λΉ„**

**μ‚¬μ© λΌμ΄λΈλ¬λ¦¬:** `cryptography` (Python), `argparse`, `os`, `struct`

---

## 5. λ³΄μ• νν‹°μ… λ‚΄ λ¨λΈ λ³µνΈν™” κΈ°λ¥ κµ¬ν„

**λ‹΄λ‹Ήμ:** μ†΅ν„μ¤€ (μ•”νΈ/ν‚¤), λ‚¨μ μ°¬ (PSA API)  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ λ””λ ‰ν† λ¦¬
`tflm_spe/partitions/`

### μ£Όμ” μ‘μ—…
- [ ] **μ•”νΈν™” λ¨λ“ ν—¤λ” κ²€ν†  λ° μμ •**
  - `tflm_spe/partitions/tflm_crypto_ops.h`
  - tflm_crypto_init(), tflm_decrypt_model() ν•¨μ μ„ μ–Έ ν™•μΈ

- [ ] **μ•”νΈν™” λ¨λ“ κµ¬ν„**
  - `tflm_spe/partitions/tflm_crypto_ops.c`
  - PSA Crypto APIλ¥Ό μ‚¬μ©ν• ν‚¤ μ¤€λΉ„ κµ¬ν„
  - AES-GCM λ³µνΈν™” λ° μΈμ¦ νƒκ·Έ κ²€μ¦ κµ¬ν„
  - encrypted_model_data.h λ°μ΄ν„° ν™μ©

- [ ] **λ³΄μ• νν‹°μ… mainμ— λ³µνΈν™” μ—°λ™**
  - `tflm_spe/partitions/tflm_secure_service_sp.c`
  - μ΄κΈ°ν™” μ‹ tflm_crypto_init() νΈμ¶
  - LOAD_MODEL μ”μ²­ μ²λ¦¬ μ‹ tflm_decrypt_model() νΈμ¶

**μ‚¬μ© API:** `psa/crypto.h` (psa_crypto_init, psa_import_key, psa_aead_decrypt)

---

## 6. TFLM λΌμ΄λΈλ¬λ¦¬ ν†µν•© λ° SP CMake μμ •

**λ‹΄λ‹Ήμ:** λ°•μμ§„, μ†΅ν„μ¤€  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ νμΌ
- `tflm_spe/partitions/CMakeLists.txt` (μμ •)
- `lib/tflite-micro/` (μ‹ κ· μ¶”κ°€)

### μ£Όμ” μ‘μ—…
- [ ] **TFLM λΌμ΄λΈλ¬λ¦¬ μ†μ¤ λ‹¤μ΄λ΅λ“ λ° λ°°μΉ**
  - lib/tflite-micro/ λλ” μ μ ν• μ™Έλ¶€ κ²½λ΅μ— λ°°μΉ

- [ ] **CMakeLists.txt μμ •**
  - TFLM λΌμ΄λΈλ¬λ¦¬λ¥Ό tflm_secure_service_sp νƒ€κ²μ— λ§ν¬
  - TFLM ν—¤λ” κ²½λ΅λ¥Ό target_include_directoriesμ— μ¶”κ°€
  - ν•„μ”μ‹ TFLM λΉλ“ μ„¤μ • μ¶”κ°€

- [ ] **λΉλ“ ν…μ¤νΈ**
  - TFLM λΌμ΄λΈλ¬λ¦¬κ°€ μ •μƒμ μΌλ΅ λ§ν¬λλ”μ§€ ν™•μΈ

**μ‚¬μ© API:** `target_link_libraries()`, `target_include_directories()`

---

## 7. λ³΄μ• νν‹°μ… λ‚΄ TFLM μ¶”λ΅  μ—”μ§„ κµ¬ν„

**λ‹΄λ‹Ήμ:** λ°•μμ§„, μ†΅ν„μ¤€  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ λ””λ ‰ν† λ¦¬
`tflm_spe/partitions/`

### μ£Όμ” μ‘μ—…
- [ ] **μ¶”λ΅  μ—”μ§„ ν—¤λ” κ²€ν†  λ° μμ •**
  - `tflm_spe/partitions/tflm_inference_engine.h`
  - TFLM APIμ— λ§λ” ν•¨μ μ„ μ–ΈμΌλ΅ μμ •

- [ ] **μ¶”λ΅  μ—”μ§„ κµ¬ν„ (μ „μ²΄ μ¬μ‘μ„±)**
  - `tflm_spe/partitions/tflm_inference_engine.c`
  - TFLM ν—¤λ” include μ¶”κ°€
  - MicroErrorReporter, MicroMutableOpResolver, MicroInterpreter κµ¬ν„
  - ν…μ„ μ•„λ λ‚ μ •μ  ν• λ‹Ή
  - tflm_init_model(): GetModel, μ—°μ‚°μ λ“±λ΅, MicroInterpreter μƒμ„±
  - tflm_run_inference(): μ…λ ¥ μ„¤μ •, Invoke, μ¶λ ¥ κ°€μ Έμ¤κΈ°

- [ ] **λ³΄μ• νν‹°μ…μ— μ¶”λ΅  μ—”μ§„ μ—°λ™**
  - `tflm_spe/partitions/tflm_secure_service_sp.c`
  - LOAD_MODEL μ”μ²­μ— TFLM μΈν„°ν”„λ¦¬ν„° μ΄κΈ°ν™” μ—°λ™
  - RUN_INFERENCE μ”μ²­μ— TFLM μ¶”λ΅  μν–‰ μ—°λ™

**μ‚¬μ© API:** TFLM C++ API (MicroErrorReporter, MicroMutableOpResolver, MicroInterpreter)

---

## 8. NSPE μ• ν”λ¦¬μΌ€μ΄μ…μ— μ‹¤μ  λ¨λΈ λ°μ΄ν„° μ¶”λ΅  μ”μ²­ κµ¬ν„

**λ‹΄λ‹Ήμ:** λ°•μμ§„ (TFLM μ—°λ™), λ‚¨μ μ°¬ (PSA API μ‚¬μ©)  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ νμΌ
`tflm_ns/app/tflm_main.c`

### μ£Όμ” μ‘μ—…
- [ ] **μ‹¤μ  λ¨λΈμ— λ§λ” μ…λ ¥ λ°μ΄ν„° μ¤€λΉ„**
  - ν„μ¬ λ”λ―Έ λ°μ΄ν„°λ¥Ό μ‹¤μ  λ¨λΈ μ…λ ¥ ν•μ‹μ— λ§κ² μμ •
  - μ…λ ¥ λ°μ΄ν„° ν¬κΈ° λ° νƒ€μ… ν™•μΈ

- [ ] **ν΄λΌμ΄μ–ΈνΈ API νΈμ¶ λ΅μ§ κ°μ„ **
  - psa_tflm_load_model() νΈμ¶ ν™•μΈ
  - psa_tflm_run_inference() νΈμ¶ ν™•μΈ
  - μ—λ¬ μ²λ¦¬ λ΅μ§ μ¶”κ°€

- [ ] **μ¶”λ΅  κ²°κ³Ό ν•΄μ„ λ° μ¶λ ¥**
  - SPλ΅λ¶€ν„° λ°›μ€ κ²°κ³Ό λ°μ΄ν„° νμ‹±
  - UARTλ¥Ό ν†µν• κ²°κ³Ό μ¶λ ¥
  - κ²°κ³Ό κ²€μ¦ λ΅μ§ μ¶”κ°€

**μ‚¬μ© API:** `tflm_interface/ns/psa_tflm_client.h`, `psa/client.h`

---

## 9. μ „μ²΄ μ‹μ¤ν… ν†µν•© ν…μ¤νΈ λ° λ””λ²„κΉ…

**λ‹΄λ‹Ήμ:** μ „μ²΄ ν€  
**μƒνƒ:** - [ ] μ‹μ‘ μ „ / - [ ] μ§„ν–‰ μ¤‘ / - [ ] μ™„λ£

### λ€μƒ νμΌ
λ¨λ“  κ΄€λ ¨ νμΌ

### μ£Όμ” μ‘μ—…
- [x] **λΉλ“ μ‹μ¤ν… κ²€μ¦**
  - build_*.sh μ¤ν¬λ¦½νΈ μ‹¤ν–‰ ν™•μΈ - β… μ •μƒ μ‹¤ν–‰ ν™•μΈ
  - CMake λΉλ“ μ¤λ¥ ν•΄κ²° - β… μ£Όμ” κ²½λ΅ λ° λ§ν¬ μ¤λ¥ ν•΄κ²°
  - λ§ν¬ μ¤λ¥ ν•΄κ²° - β… psa_tflm_client.c μ¶”κ°€λ΅ ν•΄κ²°

- [ ] **μ—”λ“ν¬μ—”λ“ κΈ°λ¥ ν…μ¤νΈ**
  - NSPEμ—μ„ λ¨λΈ μ…λ ¥ μ κ³µ
  - SPEμ—μ„ λ¨λΈ λ΅λ“ λ° λ³µνΈν™” ν™•μΈ
  - SPEμ—μ„ TFLM μ¶”λ΅  μν–‰ ν™•μΈ
  - NSPEμ—μ„ κ²°κ³Ό μμ‹  λ° κ²€μ¦

- [ ] **λ””λ²„κΉ… λ° μµμ ν™”**
  - λ΅κ·Έ λ¶„μ„μ„ ν†µν• μ¤λ¥ μμ •
  - λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ κ²€ (μ¤νƒ, ν…μ„ μ•„λ λ‚)
  - μ„±λ¥ ν…μ¤νΈ λ° μµμ ν™”

- [ ] **λ³΄λ“ ν”λμ‹± λ° μ‹¤μ  ν•λ“μ›¨μ–΄ ν…μ¤νΈ**
  - UF2 νμΌ μƒμ„± ν™•μΈ
  - Raspberry Pi Pico 2Wμ— ν”λμ‹±
  - UART λ΅κ·Έ ν™•μΈ

---

## μ°μ„ μμ„ λ° μμ΅΄μ„±

### μ°μ„ μμ„ 1 (κΈ°λ° κµ¬μ΅°)
- **Task 1:** TFLM μ„λΉ„μ¤ μΈν„°νμ΄μ¤ μ •μ
- **Task 2:** TFLM λ³΄μ• νν‹°μ… κΈ°λ³Έ κµ¬μ΅° μƒμ„±
- **Task 3:** λΉ„λ³΄μ• μ• ν”λ¦¬μΌ€μ΄μ… κΈ°λ³Έ ν΄λΌμ΄μ–ΈνΈ μ‘μ„±

### μ°μ„ μμ„ 2 (ν•µμ‹¬ κΈ°λ¥)
- **Task 4:** λ¨λΈ μ•”νΈν™” μ¤ν¬λ¦½νΈ μ‘μ„±
- **Task 5:** λ³΄μ• νν‹°μ… λ‚΄ λ¨λΈ λ³µνΈν™” κΈ°λ¥ κµ¬ν„
- **Task 6:** TFLM λΌμ΄λΈλ¬λ¦¬ ν†µν•©

### μ°μ„ μμ„ 3 (κ³ κΈ‰ κΈ°λ¥)
- **Task 7:** TFLM μ¶”λ΅  μ—”μ§„ κµ¬ν„
- **Task 8:** μ‹¤μ  λ¨λΈ λ°μ΄ν„° μ¶”λ΅  μ”μ²­ κµ¬ν„

### μ°μ„ μμ„ 4 (ν†µν•© λ° κ²€μ¦)
- **Task 9:** μ „μ²΄ μ‹μ¤ν… ν†µν•© ν…μ¤νΈ λ° λ””λ²„κΉ…

### μμ΅΄μ„±
- **Task 2** β†’ **Task 1** (μΈν„°νμ΄μ¤ μ •μ ν•„μ”)
- **Task 3** β†’ **Task 1** (μΈν„°νμ΄μ¤ μ •μ ν•„μ”)
- **Task 5** β†’ **Task 4** (μ•”νΈν™” μ¤ν¬λ¦½νΈ ν•„μ”)
- **Task 7** β†’ **Task 6** (TFLM λΌμ΄λΈλ¬λ¦¬ ν•„μ”)
- **Task 8** β†’ **Task 7** (μ¶”λ΅  μ—”μ§„ ν•„μ”)
- **Task 9** β†’ **Task 1~8** (λ¨λ“  κµ¬μ„± μ”μ† ν•„μ”)

---

## μ°Έκ³  μ‚¬ν•­

### ν„μ¬ ν”„λ΅μ νΈ μƒνƒ
- β… κΈ°λ³Έ TF-M κµ¬μ΅°λ” κµ¬μ¶•λ¨
- β… TFLM μΈν„°νμ΄μ¤ νμΌλ“¤ μ΅΄μ¬
- β… λ³΄μ• νν‹°μ… κΈ°λ³Έ κµ¬μ΅° μ΅΄μ¬
- β… NS μ• ν”λ¦¬μΌ€μ΄μ… κΈ°λ³Έ κµ¬μ΅° μ΅΄μ¬
- β… λΉλ“ μ‹μ¤ν… μ„¤μ •λ¨

### ν•΄κ²°λ λΉλ“ λ¬Έμ 
- β… `psa_tflm_defs.h` κ²½λ΅ λ¬Έμ  ν•΄κ²°
- β… `psa_tflm_client.h` κ²½λ΅ λ¬Έμ  ν•΄κ²°
- β… λ§ν¬ μ¤λ¥ (psa_tflm_client.c μ¶”κ°€) ν•΄κ²°

### λ‹¤μ λ‹¨κ³„
1. κ° Taskμ ν„μ¬ κµ¬ν„ μƒνƒ κ²€ν† 
2. λ„λ½λ κΈ°λ¥ μ‹λ³„ λ° κµ¬ν„
3. λ‹¨κ³„λ³„ ν…μ¤νΈ λ° κ²€μ¦
4. ν†µν•© ν…μ¤νΈ μν–‰

---

## μ§„ν–‰ μƒν™© μ—…λ°μ΄νΈ

| Task | μƒνƒ | μ™„λ£μΌ | λΉ„κ³  |
|------|------|--------|------|
| Task 1 | π΅ μ§„ν–‰ μ¤‘ | - | μΈν„°νμ΄μ¤ μ •μ κ²€ν†  μ¤‘ |
| Task 2 | π΅ μ§„ν–‰ μ¤‘ | - | λΉλ“ μ¤λ¥ μΌλ¶€ ν•΄κ²° |
| Task 3 | π΅ μ§„ν–‰ μ¤‘ | - | λ§ν¬ μ¤λ¥ ν•΄κ²° μ™„λ£ |
| Task 4 | β μ‹μ‘ μ „ | - | - |
| Task 5 | β μ‹μ‘ μ „ | - | - |
| Task 6 | β μ‹μ‘ μ „ | - | - |
| Task 7 | β μ‹μ‘ μ „ | - | - |
| Task 8 | β μ‹μ‘ μ „ | - | - |
| Task 9 | β μ‹μ‘ μ „ | - | - |

**λ²”λ΅€:**
- β μ‹μ‘ μ „
- π΅ μ§„ν–‰ μ¤‘  
- πΆ μ™„λ£
- π”΄ μ¤‘λ‹¨/λ¬Έμ 
